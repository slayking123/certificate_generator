<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../CSS/template.css">
    <script src="../js/jquery.min.js"></script>
    <style>
        body{
      background-color: #1F1D36;
  }
  .hr1{
    min-height: 10px;
    background-color: #F3F0D7;
  }
  .hd1{
    color: rosybrown;
    display: flex;
    justify-content: center;
    padding-top: 5px;
  }
    </style>
</head>
<body>
  <div class="hd1">
    <h1 >This is your preview!!!!</h1>
  </div>
    <div id="preview">
    </div>
    <script>
      async function getdata()
        {
            var data;
           await fetch('http://localhost:4000/generate/'+localStorage.getItem("id")).then(res=>{
               return res.json()
            }).then(msg=>data=msg)
            let preview=document.querySelector('#preview')
            console.log(data)
            for (let i = 0; i < data.length; i++) {
              var a=document.createElement('a');
              a.setAttribute("id","a-"+i)
              var can=document.createElement('canvas')
              can.setAttribute('id','can-'+i)
              can.setAttribute('height','450px')
              can.setAttribute('width','600px')
              a.appendChild(can);
              var canvas=document.getElementById('can-'+i)
        var image=new Image()
        image.src="../Images/template.png"
        var ctx=canvas.getContext("2d")
        image.onload=(function()
        {
          ctx.drawImage(image,0,0,canvas.width,canvas.height)
            ctx.font="36px BeVietnam"
            ctx.fillStyle="yellow"
            ctx.fillText(data[i]['studentname'],180,230)
            ctx.font="20px BeVietnam"
            ctx.fillStyle="yellow"
            ctx.fillText(data[i]['branch'],360,335)
            ctx.font="18px BeVietnam"
            ctx.fillStyle="yellow"
            ctx.fillText(data[i]['Certifiatenme'],380,278.3)
        })
        var btn=document.getElementById('a-'+i)
        btn.addEventListener("click",function()
        {
          btn.href=canvas.toDataURL('image/jpeg')
          btn.download='certificate-'+data[i]['name']
        })
        preview.appendChild(a);
            }
        }
        getdata();
    </script> 
</body>
</html>